#!/usr/bin/env ruby

begin
  require "bbcloud/cli"
rescue LoadError
  bbcloud_path = File.expand_path('../../lib', __FILE__)
  $:.unshift(bbcloud_path)
  require "bbcloud/cli"
end

if ARGV.size > 0
  servers = ARGV.collect { |arg| API.servers.get arg }
else
  servers = API.servers
end

servers.sort! { |a,b| a.created_at <=> b.created_at }

servers.each do |server|
  next if server.status == "deleted"
  output = [server.id]

  output << server.image_id
  output << server.status.pad_to(10)
  output << server.flavor_id
  output << server.created_at.rfc8601
  internal_ips = server.interfaces.collect { |i| i['ipv4_address'] }
  output << internal_ips.join(",").pad_to(16)
#  output << ["public", server.id, "gb1.eu.brightbox.com"].join('.')
#  output << server.description.to_s.strip
  puts output.join("  ")
end
